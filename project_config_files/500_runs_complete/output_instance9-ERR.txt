
R version 3.0.1 (2013-05-16) -- "Good Sport"
Copyright (C) 2013 The R Foundation for Statistical Computing
Platform: x86_64-w64-mingw32/x64 (64-bit)

R is free software and comes with ABSOLUTELY NO WARRANTY.
You are welcome to redistribute it under certain conditions.
Type 'license()' or 'licence()' for distribution details.

  Natural language support but running in an English locale

R is a collaborative project with many contributors.
Type 'contributors()' for more information and
'citation()' on how to cite R or R packages in publications.

Type 'demo()' for some demos, 'help()' for on-line help, or
'help.start()' for an HTML browser interface to help.
Type 'q()' to quit R.

> rm(list = ls()) #remove all past worksheet variables
> ###################################
> ####SET SOURCE LOCATION############
> ###################################
> machine = 1 #use 1 for LF laptop, 2 for LF hard drive, 3 for IRC local drive
> #Assigns source file (directory_registry file) to appropriate hardware (according to machine number)
> if (machine == 1){
+   source(paste0("C:/Users/lfortini/","directory_registry.r"))
+   server = F
+ } else {
+   if (machine == 2) {
+     source(paste0("C:/Users/lfortini/","directory_registry.r")) #actually same as above
+     server = F
+   } else {
+     if (machine == 3) {
+       source(paste0("C:/USGS_Honolulu/PICCC_code/Ensemble_SDM/IRC/directory_registryIRC.r"))
+       server = F
+     } else {
+       cat('\n','Error - invalid machine number')
+     }
+   }
+ }
> 
> ###################################
> ####GENERAL MODEL CONFIGURATION####
> ###################################
> #setting file locations 
> project_name='full100run__newclim_100m_noRF__P_A_medPAdens_1' #assign project name to the current run
> 
> #choose species of interest - all (from CSV file) or subset listed
> run_all_spp = F #if running all species enter "T" and if only subset enter "F"
> spp_subset = c('Akekee', 'Akiapolauu', 'Akikiki', 'Akohekohe', 'Anianiau', 'Apapane', 'Hawaii_Akepa', 'Hawaii_Creeper', 'Hawaii_Elepaio', 'Iiwi', 'Kauai_Amakihi', 'Kauai_Elepaio', 'Maui_Alauahio', 'Maui_Parrotbill', 'Oahu_Amakihi', 'Oahu_Elepaio', 'Omao', 'Palila', 'Puaiohi', 'Hawaii_Amakihi', 'Amakihi', 'Elepaio')
> 
> #Biomod2 modelling options for species of interest
> models_to_run = c('GBM','MAXENT') #choose biomod2 models to run - possibilities are: 'GLM','GBM','GAM','CTA','ANN','SRE','FDA','MARS','RF','MAXENT' 
> eval_stats=c("ROC", "KAPPA", "TSS") #choose evaluation methods - possibilties are: 'KAPPA','TSS','ROC'
> env_var_files = c("bio1.tif", "bio7.tif", "bio12.tif", "bio15.tif") #choose bioclimatic variables of interest
> plot_graphs = T #plot graphs of results (T) or not (F)
> EM_fit = T #if you want to run the model fitting = T
> EM_ensemble = T #if you want to run the ensemble modelling = T
> EM_project = T #if you want to project the model results = T
> create_response_curves = F
> apply_biomod2_fixes = T #if running large models use this option - solves memory problems
> overwriteData = F #T if want to overwrite and F if not
> paralelize=T #turn on multi instance auto start
> 
> #################################
> ####CONFIG FOR SPECIFIC STEPS####
> #################################
> ####fit config (script#1)
> NbRunEval = 5 #number of evaluation runs for ensemble modeling
> include_Abs = T #in test phase
> PseudoAbs_outside_CE = T #if T, will only consider Pseudo Absences outside climate envelope of all points collected
> dens_PAs_outside_CE=1 #if 1 will create PA density that is equal to point density within surveyed areas
> PA.nb.rep = 20
> PA.nb.absences = 10000 #asssign number of Pseudo absence points (if PseudoAbs_outside_CE = T, this will be overridden! (n of PAs will be determined by P/A point density within CE)) 
> candidatePAperPA=50 #only used if if PAs_outside_CE = F, if value == 0, will use PA.nb.absences   
> PA.strategy = "random" #strategy for selecting pseudo absences ('random', 'sre', 'disk' or 'user.defined')
> equiv_100m = 0.0009430131
> PA.dist.min = 5*equiv_100m #500m min distance from actual data points - only for 'disk' absences selection
> do.full.models = T
> 
> ####ensemble config (script#2)
> eval.metric.threshold = rep(0.5,length(eval_stats)) #sets the minimum scores below which models will be excluding when building ensembles
> 
> ####projection config (script#3)
> baseline_or_future = 4 #1 for baseline, 4 for future
> clampingMask = F #if T clamping mask will be saved
> memory = T #keep.in.memory = memory; if T and clamping Mask = T, clamping mask will be saved to hard drive 
> 
> 
> ##########################
> ####RUNNING SCRIPTS!!!####
> ##########################
> library(stringr)
> working_dir = paste(resultsDir, project_name, sep = "/") #assign working directory
> crop_raster_dir = paste0(working_dir, "/map_crop") #assign directory for cropped raster files
> csv_dir = paste0(working_dir,"/single_sp_CSVs") #assign directory for single species CSV's
> dir.create(working_dir, showWarnings = F) #creates working directory if missing
> 
> #Assigns the species names either according to csv file (all) or list
> if (run_all_spp){
+   spp_nm = read.csv(allSppNames, header = F, stringsAsFactors = F)
+ } else {
+   spp_nm = spp_subset
+ }
> 
> ##Plotting options depending on if server or not
> if (server == TRUE){
+   useRasterDef = FALSE
+   interpolateDef = TRUE
+ } else {
+   useRasterDef = TRUE
+   interpolateDef = FALSE
+ }
> 
> dir_for_temp_files <- paste(rootDir,'temp', project_name, baseline_or_future, 
+                             sep = "/") #dir for temp run data (to avoid memory errors)
> 
> if (apply_biomod2_fixes){
+ maxentWDtmp = paste0("maxentWDtmp_", baseline_or_future)
+ dir.create(dir_for_temp_files, showWarnings=F, recursive=T)
+ }
> 
> #this code below will subset species into the right number of instances started with the bat file                        
> n_instances=length(list.files(working_dir, pattern="^00instance"))
> #cpucores=as.integer(Sys.getenv('NUMBER_OF_PROCESSORS'))
> cpucores=12
> if (paralelize){
+   Sys.sleep(6) 
+   if (cpucores>length(spp_nm)){cpucores=length(spp_nm)}
+   jnkn=length(spp_nm)
+   x=c(1:jnkn)
+   chunk <- function(x,n) split(x, factor(sort(rank(x)%%n)))
+   groups=chunk(x,cpucores)
+   jnk=groups[n_instances+1][[1]]
+   spp_nm=spp_nm[jnk]
+   spp_str=""
+   for (sp_nm in spp_nm){
+     spp_str=paste(spp_str,sp_nm,sep="__")
+   }
+   time=Sys.time()
+   time=str_replace_all(time,":", ".")
+   instance_file=paste0("00instance_",n_instances+1,spp_str,"_",time)
+   file.create(paste0(working_dir,"/",instance_file),showWarnings=F)  
+ }
[1] TRUE
> 
> 
> ####Runs script for model fitting, creating ensemble models, and projecting models according to settings above.
> ##start the clock
> ptmOverallStart <- proc.time()
> 
> if (EM_fit){ #runs fitting code
+   source(paste0(codeDir,"/1_BM2_FB_SDM_fitting_w_cropping4_postmerge.r")) 
+ }
Loading required package: abind
Loading required package: sp
Loading required package: raster
Loading required package: rasterVis
Loading required package: lattice
Loading required package: latticeExtra
Loading required package: RColorBrewer
Loading required package: hexbin
Loading required package: grid
Loading required package: nnet
Loading required package: gbm
Loading required package: survival
Loading required package: splines
Loading required package: parallel
Loaded gbm 2.1
Loading required package: mda
Loading required package: class
Loaded mda 0.4-4

Loading required package: randomForest
randomForest 4.6-7
Type rfNews() to see new features/changes/bug fixes.
Loading required package: rpart
Loading required package: pROC
Loading required package: plyr
Type 'citation("pROC")' for a citation.

Attaching package: 'pROC'

The following object is masked from 'package:stats':

    cov, smooth, var

biomod2 2.1.15 loaded.

 Copying of necessary files is complete
 Oahu_Elepaio model fitting...
 fitting for  Oahu_Elepaio already done...
 Omao model fitting...
 fitting for  Omao already done...> if (create_response_curves){
+   source(paste0(codeDir,"/2opt_BM2_FB_SDM_response_curves3.r"))
+ }
> if (EM_ensemble){ #runs ensemble code
+   source(paste0(codeDir,"/2_BM2_FB_SDM_EM_fitting2_IRC.r")) 
+ }

 Oahu_Elepaio ensemble creation...
 Oahu_Elepaio ensemble previously done...
 Omao ensemble creation...
 Omao ensemble previously done...Warning message:
In memory.limit(size = 4095) : cannot decrease memory limit: ignored
> if (EM_project){ #runs projection code
+   source(paste0(codeDir,"/3_BM2_FB_SDM_EM_projection_with_crop4_IRC.r")) 
+ }

 Oahu_Elepaio model projection...
 Oahu_Elepaio previously calculated...
 Omao model projection...
 using these env files for projection raster: bio1.tif bio7.tif bio12.tif bio15.tif 
 from dir: D:/PICCC_data/climate_data/bioclim_data_Aug2013/complete_rasters/bioclims_abs/all_future/500m/rgdal: version: 0.8-11, (SVN revision 479M)
Geospatial Data Abstraction Library extensions to R successfully loaded
Loaded GDAL runtime: GDAL 1.9.2, released 2012/10/08
Path to GDAL shared files: D:/Documents/R/win-library/3.0/rgdal/gdal
GDAL does not use iconv for recoding strings.
Loaded PROJ.4 runtime: Rel. 4.7.1, 23 September 2009, [PJ_VERSION: 470]
Path to PROJ.4 shared files: D:/Documents/R/win-library/3.0/rgdal/proj
  |                                                                              |                                                                      |   0%  |                                                                              |==================                                                    |  25%  |                                                                              |===================================                                   |  50%  |                                                                              |====================================================                  |  75%  |                                                                              |======================================================================| 100%

0 seconds
  |                                                                              |                                                                      |   0%  |                                                                              |==================                                                    |  25%  |                                                                              |===================================                                   |  50%  |                                                                              |====================================================                  |  75%  |                                                                              |======================================================================| 100%

0 seconds
  |                                                                              |                                                                      |   0%  |                                                                              |==================                                                    |  25%  |                                                                              |===================================                                   |  50%  |                                                                              |====================================================                  |  75%  |                                                                              |======================================================================| 100%

0 seconds
  |                                                                              |                                                                      |   0%  |                                                                              |==================                                                    |  25%  |                                                                              |===================================                                   |  50%  |                                                                              |====================================================                  |  75%  |                                                                              |======================================================================| 100%

0 seconds

 Omao projection raster stack created...
-=-=-=-=-=-=-=-=-=-=-=-=-=-= Do Models Projections -=-=-=-=-=-=-=-=-=-=-=-=-=-=

   ! Results will be saved as individual RasterLayers because of a lack of memory !
	> Projecting Omao_PA1_RUN1_GBM ...1 seconds
0 seconds
  |                                                                              |                                                                      |   0%  |                                                                              |==================                                                    |  25%  |                                                                              |===================================                                   |  50%  |                                                                              |====================================================                  |  75%  |                                                                              |======================================================================| 100%

0 seconds
  |                                                                              |                                                                      |   0%  |                                                                              |==================                                                    |  25%  |                                                                              |===================================                                   |  50%  |                                                                              |====================================================                  |  75%  |                                                                              |======================================================================| 100%

0 seconds

		Writing projection on hard drive...  |                                                                              |                                                                      |   0%  |                                                                              |==================                                                    |  25%  |                                                                              |===================================                                   |  50%  |                                                                              |====================================================                  |  75%  |                                                                              |======================================================================| 100%

0 seconds

	> Projecting Omao_PA1_RUN1_MAXENT ...
		Creating Maxent Temp Proj Data...
 Omao/maxentWDtmp_4/./maxentWDtmp_4//bio1.asc already created !
 Omao/maxentWDtmp_4/./maxentWDtmp_4//bio7.asc already created !
 Omao/maxentWDtmp_4/./maxentWDtmp_4//bio12.asc already created !
 Omao/maxentWDtmp_4/./maxentWDtmp_4//bio15.asc already created !
		Running Maxent...Oct 22, 2013 3:14:57 PM java.util.prefs.WindowsPreferences <init>
WARNING: Could not open/create prefs root node Software\JavaSoft\Prefs at root 0x80000002. Windows RegCreateKeyEx(...) returned error code 5.
Error in file D:\PICCC_analysis\FB_analysis\model_results\biomod2\full100run__newclim_100m_noRF__P_A_medPAdens_1\Omao\maxentWDtmp_4\maxentWDtmp_4\Proj\bio15.asc: java.io.IOException: Unexpected end of file
Error: Error in file D:\PICCC_analysis\FB_analysis\model_results\biomod2\full100run__newclim_100m_noRF__P_A_medPAdens_1\Omao\maxentWDtmp_4\maxentWDtmp_4\Proj\bio15.asc

		Reading Maxent outputs...Error in file(x, "rb") : cannot open the connection
Calls: source ... .local -> .rasterObjectFromFile -> .isNetCDF -> file
In addition: Warning messages:
1: In .datatype(...) : FLT8 is an invalid datatype, changed to "FLT8S"
2: In .datatype(...) : FLT8 is an invalid datatype, changed to "FLT8S"
3: In .datatype(...) : FLT8 is an invalid datatype, changed to "FLT8S"
4: In .datatype(...) : FLT8 is an invalid datatype, changed to "FLT8S"
Execution halted
